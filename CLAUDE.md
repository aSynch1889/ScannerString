# 开发指导原则

## 开发哲学

### 核心理念

- **渐进式开发胜过大爆炸式** - 小的变更能够编译并通过测试
- **从现有代码中学习** - 先研究和规划，再实施
- **务实胜过教条** - 适应项目的实际情况
- **清晰意图胜过聪明代码** - 选择简单明了的方案

### 简单性原则

- 每个函数/类只负责单一职责
- 避免过早抽象
- 不要使用巧妙的技巧 - 选择简单的解决方案
- 如果需要解释，说明太复杂了

## 开发流程

### 1. 规划和分阶段

将复杂工作分解为3-5个阶段。在 `IMPLEMENTATION_PLAN.md` 中记录：

```markdown
## 阶段 N: [名称]
**目标**: [具体交付物]
**成功标准**: [可测试的结果]
**测试**: [具体测试用例]
**状态**: [未开始|进行中|已完成]
```

- 随着进展更新状态
- 所有阶段完成后删除文件

### 2. 实现流程

1. **理解** - 研究代码库中的现有模式
2. **测试** - 先写测试（红灯）
3. **实现** - 最少代码通过测试（绿灯）
4. **重构** - 在测试通过的情况下清理代码
5. **提交** - 用清晰的信息关联到计划

### 3. 遇到困难时（3次尝试后）

**关键**: 每个问题最多尝试3次，然后停止。

1. **记录失败原因**:
   - 你尝试了什么
   - 具体的错误信息
   - 你认为失败的原因

2. **研究替代方案**:
   - 找到2-3个类似的实现
   - 注意使用的不同方法

3. **质疑基本假设**:
   - 这是正确的抽象级别吗？
   - 可以拆分成更小的问题吗？
   - 有更简单的方法吗？

4. **尝试不同角度**:
   - 不同的库/框架特性？
   - 不同的架构模式？
   - 移除抽象而不是增加？

## 技术标准

### 架构原则

- **组合优于继承** - 使用依赖注入
- **接口优于单例** - 启用测试和灵活性
- **显式优于隐式** - 清晰的数据流和依赖关系
- **尽可能测试驱动** - 永远不要禁用测试，修复它们

### 代码质量

- **每次提交必须**:
  - 编译成功
  - 通过所有现有测试
  - 包含新功能的测试
  - 遵循项目格式化/检查规范

- **提交前**:
  - 运行格式化器/检查器
  - 自我审查变更
  - 确保提交信息解释"为什么"

### 错误处理

- 快速失败并提供描述性消息
- 包含调试上下文
- 在适当的层级处理错误
- 永远不要默默吞噬异常

## 决策框架

当存在多个有效方法时，基于以下标准选择：

1. **可测试性** - 我能轻松测试这个吗？
2. **可读性** - 6个月后有人能理解这个吗？
3. **一致性** - 这符合项目模式吗？
4. **简单性** - 这是有效的最简单解决方案吗？
5. **可逆性** - 以后修改有多困难？

## 项目集成

### 学习代码库

- 找到3个类似的功能/组件
- 识别通用模式和约定
- 尽可能使用相同的库/工具
- 遵循现有的测试模式

### 工具使用

- 使用项目现有的构建系统
- 使用项目的测试框架
- 使用项目的格式化器/检查器设置
- 没有强有力的理由不要引入新工具

## 质量关卡

### 完成定义

- [ ] 编写并通过测试
- [ ] 代码遵循项目约定
- [ ] 没有检查器/格式化器警告
- [ ] 提交信息清晰
- [ ] 实现符合计划
- [ ] 没有无问题编号的TODO

### 测试指导原则

- 测试行为，不是实现
- 尽可能每个测试一个断言
- 清晰的测试名称描述场景
- 使用现有的测试工具/助手
- 测试应该是确定性的

## 重要提醒

**永远不要**:

- 使用 `--no-verify` 绕过提交钩子
- 禁用测试而不是修复它们
- 提交不能编译的代码
- 做假设 - 用现有代码验证

**始终**:

- 增量提交可工作的代码
- 随时更新计划文档
- 从现有实现中学习
- 3次失败尝试后停止并重新评估
